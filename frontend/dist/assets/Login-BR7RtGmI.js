import{m as S,d as I,e as h,f as i,a as _,w as t,o as w,g as o,b as p}from"./index-CU9jrytz.js";const L={__name:"Login",props:S(["onSubPage"],{email:{},emailModifiers:{},password:{},passwordModifiers:{}}),emits:S(["setIsLoggedInParent","setDisplayMessage","setMessageRef","setSeverityRef"],["update:email","update:password"]),setup(v,{emit:M}){const g=M,b=v,f=I(v,"email"),m=I(v,"password"),y=h(),d=h(),s=(n,e)=>{g("setDisplayMessage",!0),g("setMessageRef",n),g("setSeverityRef",e)},P=async()=>{const n=f.value,e=m.value,a=await(await fetch("http://localhost:5170/api/users",{method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify({email:n})})).json();if(a.isFound)s("found same login","info");else{s("adding","info");try{const l=await(await fetch("http://localhost:5170/api/users/register",{method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify({email:n,password:e})})).json();s(l.message,"info")}catch{s(a.message,"error")}}y._value.reset()};(()=>{sessionStorage.getItem("logged")?d.value=!0:d.value=!1})();const k=()=>{sessionStorage.removeItem("logged"),sessionStorage.removeItem("id"),d.value=!1,s("you are logged out","info")},C=async()=>{if(sessionStorage.getItem("logged"))s("you are already logged in","info");else{const n=f.value,e=m.value;try{const a=await(await fetch("http://localhost:5170/api/users/login",{method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify({email:n,password:e})})).json();a.isFound===!0?(s("you are logged in","info"),sessionStorage.setItem("logged",!0),d.value=!0,sessionStorage.setItem("id",a.userId),b.onSubPage&&g("setIsLoggedInParent")):s("inwalid data","error")}catch{s("inwalid data","error")}}y._value.reset()};return(n,e)=>{const u=i("v-text-field"),a=i("v-col"),c=i("v-row"),l=i("v-btn"),V=i("v-container"),O=i("v-form");return w(),_(O,{ref_key:"form",ref:y},{default:t(()=>[o(V,null,{default:t(()=>[o(c,null,{default:t(()=>[o(a,{cols:"12",md:"4"},{default:t(()=>[o(u,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=r=>f.value=r),label:"E-mail","hide-details":"",required:""},null,8,["modelValue"])]),_:1}),o(a,{cols:"12",md:"4"},{default:t(()=>[o(u,{type:"password",modelValue:m.value,"onUpdate:modelValue":e[1]||(e[1]=r=>m.value=r),label:"Password","hide-details":"",required:""},null,8,["modelValue"])]),_:1})]),_:1}),o(c,null,{default:t(()=>[o(a,null,{default:t(()=>[o(l,{type:"reset"},{default:t(()=>[p(" clear ")]),_:1}),o(l,{onClick:e[2]||(e[2]=r=>P())},{default:t(()=>[p(" Register ")]),_:1}),d.value?(w(),_(l,{key:1,onClick:e[4]||(e[4]=r=>k())},{default:t(()=>[p(" log out ")]),_:1})):(w(),_(l,{key:0,onClick:e[3]||(e[3]=r=>C())},{default:t(()=>[p(" log in ")]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1},512)}}};export{L as default};
